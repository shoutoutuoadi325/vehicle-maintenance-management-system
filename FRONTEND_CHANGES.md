# 前端代码修改说明 - 支持碳排放评估功能

## 修改概述
根据PR #5新增的碳排放评估功能，前端代码已完成相应适配。

## 后端新增字段
根据后端PR，新增了以下字段：
- `ecoMaterial` (Boolean) - 是否环保材料
- `reworkCount` (Integer) - 返工次数
- `repairType` (String) - 维修方案类型（"repair" 或 "replace"）
- `estimatedEmission` (Double) - 预估碳排放量（后端自动计算）

## 前端修改详情

### 1. CustomerDashboard.vue（客户端）

#### 1.1 数据模型更新
在 `repairOrderForm` 中新增三个字段：
```javascript
repairOrderForm: {
  vehicleId: '',
  description: '',
  preferredDate: '',
  contactPhone: '',
  requiredSkillType: '',
  ecoMaterial: false,        // 新增：是否环保材料，默认false
  reworkCount: 0,            // 新增：返工次数，默认0
  repairType: 'repair'       // 新增：维修方案类型，默认"repair"
}
```

#### 1.2 预约维修表单增加字段
在"预约维修"模态框中新增以下表单控件：

**维修方案类型选择：**
- 下拉选择框：修复 / 更换
- 说明提示：选择"修复"通常比"更换"产生更低的碳排放

**环保材料选项：**
- 复选框：使用环保材料
- 说明提示：环保材料可显著降低维修过程的碳排放

**返工次数输入：**
- 数字输入框：返工次数
- 说明提示：返工会增加碳排放，首次维修请填0

#### 1.3 提交订单时传递新字段
在 `submitRepairOrder()` 方法中，将新字段添加到 `orderData`：
```javascript
const orderData = {
  // ...其他字段
  ecoMaterial: this.repairOrderForm.ecoMaterial,
  reworkCount: this.repairOrderForm.reworkCount || 0,
  repairType: this.repairOrderForm.repairType
};
```

#### 1.4 订单详情显示碳排放信息
在订单详情模态框中新增"绿色导向 - 碳排放评估"部分：
- 显示预估碳排放量（kg CO₂）
- 显示维修方案类型（修复/更换）
- 显示是否使用环保材料
- 显示返工次数
- 提示：选择修复方案和环保材料可以有效降低碳排放

#### 1.5 样式更新
新增碳排放信息显示的CSS样式：
- 绿色渐变背景 (linear-gradient)
- 碳排放徽章 (emission-badge)
- 详细信息网格 (emission-details)
- 提示信息 (emission-tips)

### 2. AdminDashboard.vue（管理员端）

#### 2.1 订单详情显示
在订单详情模态框中新增"绿色导向 - 碳排放评估"部分（与客户端类似）：
- 显示预估碳排放量
- 显示维修方案、环保材料、返工次数
- 提示：该工单的碳排放评估基于维修工时、材料类型和维修方案自动计算

#### 2.2 样式更新
新增相同的碳排放信息显示CSS样式

### 3. TechnicianDashboard.vue（技师端）

#### 3.1 任务详情显示
在任务详情模态框中新增"绿色导向 - 碳排放评估"部分：
- 显示预估碳排放量
- 显示维修方案、环保材料、返工次数
- 提示：优先使用修复方案和环保材料，减少返工可降低碳排放

#### 3.2 样式更新
新增相同的碳排放信息显示CSS样式

## 功能特性

### 用户体验优化
1. **视觉引导**：使用绿色主题和叶子图标，突出环保理念
2. **智能提示**：在表单中提供碳排放相关的提示信息
3. **默认值设置**：合理的默认值（首次维修、修复方案、非环保材料）
4. **条件显示**：只有当订单包含碳排放数据时才显示相关信息

### 绿色导向设计
1. **修复优于更换**：提示用户选择修复方案可降低碳排放
2. **环保材料推荐**：鼓励用户选择环保材料
3. **返工提醒**：提示返工会增加碳排放，提高首次修好率
4. **碳排放可视化**：直观显示每个订单的碳排放预估值

## 技术实现细节

### 数据流
1. 客户创建维修单时填写三个新字段
2. 数据提交到后端API `/repair-orders`
3. 后端自动计算 `estimatedEmission` 并保存
4. 查询订单详情时，前端接收完整的订单数据（包括碳排放信息）
5. 前端根据数据展示碳排放评估信息

### 兼容性处理
- 使用 `v-if` 条件渲染，确保只有包含碳排放数据的订单才显示评估信息
- 对历史订单（无碳排放字段）保持兼容
- 空值检查：`selectedOrder.estimatedEmission !== null && selectedOrder.estimatedEmission !== undefined`

## 测试建议

### 功能测试
1. **创建订单**：测试填写不同的碳排放相关字段组合
2. **查看详情**：验证碳排放信息正确显示
3. **边界情况**：测试空值、0值、大数值的处理
4. **旧数据兼容**：查看历史订单（无碳排放字段）是否正常显示

### UI测试
1. **表单布局**：验证新增字段在不同屏幕尺寸下的显示
2. **颜色主题**：确认绿色主题与整体设计协调
3. **图标显示**：验证Font Awesome图标正确加载
4. **提示文本**：确认所有提示信息清晰易懂

## 部署说明
1. 确保后端API已部署PR #5的代码
2. 数据库已添加新字段：`estimated_emission`, `eco_material`, `rework_count`, `repair_type`
3. 前端代码无需额外配置，直接部署即可

## 注意事项
1. 前端不计算碳排放值，由后端自动计算
2. 新字段为可选字段，但建议引导用户填写以获得准确的碳排放评估
3. 碳排放单位为 kg CO₂
4. 保留两位小数显示：`toFixed(2)`
