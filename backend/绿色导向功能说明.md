# 绿色导向的维修决策辅助功能说明

## 代码具体修改点

1. 新增 EmissionCalculatorService.java
    - 新建服务类，负责根据工单字段自动计算碳排放（estimatedEmission）。

2. 修改 RepairOrder.java
    - 新增字段：estimatedEmission（碳排放评估值）、ecoMaterial（是否环保材料）、reworkCount（返工次数）、repairType（维修方案类型：修复/更换）。
    - 生成上述字段的 getter/setter。

3. 修改 RepairOrderService.java
    - 注入 EmissionCalculatorService。
    - 在创建工单时自动调用其方法计算 estimatedEmission 字段，并保存到数据库。

4. 修改 NewRepairOrderRequest.java
    - 新增 ecoMaterial、reworkCount、repairType 字段，支持前端传递这些绿色相关参数。

5. 新增单元测试 EmissionCalculatorServiceTest.java
    - 验证碳排放计算逻辑的正确性。

6. 新增本说明文档，详细描述功能和测试建议。

本系统集成了“维修过程碳排放评估模型”，在维修工单创建和分配时，自动评估并记录碳排放值，辅助绿色决策。

## 评估逻辑
- 维修工时：设备运转时间越长，排放越高
- 材料类型：环保材料排放系数低
- 返工次数：返工越多，排放越高
- 维修方案类型：修复优于更换

### 计算公式
```
碳排放 = 工时 × 材料系数 × 方案系数 + 返工次数 × 返工系数
- 环保材料系数 = 1.0，普通材料 = 2.0
- 修复方案系数 = 1.0，更换方案 = 2.0
- 返工系数 = 1.5
```

## 主要功能
- 维修工单自动计算 estimatedEmission 字段
- 工单分配和方案推荐时，优先考虑排放更低的选项
- 管理员可在后台查看各维修单碳排放评估值

## 示例
| 工单 | 工时 | 材料 | 返工 | 方案 | 估算排放 |
|------|------|------|------|------|----------|
| 1    | 2h   | 环保 | 0    | 修复 | 2        |
| 2    | 2h   | 普通 | 1    | 更换 | 6        |

## 测试脚本建议
1. 新建/修改工单时，传入不同参数，检查 estimatedEmission 计算是否正确。
2. 模拟多种维修方案，验证推荐优先级是否按排放值排序。
3. 检查返工次数变化时，排放值是否同步更新。

### Java 单元测试示例
```java
@Test
public void testEmissionCalculation() {
    RepairOrder order = new RepairOrder();
    order.setEstimatedHours(2.0);
    order.setEcoMaterial(true);
    order.setReworkCount(0);
    order.setRepairType("repair");
    double emission = emissionCalculatorService.calculate(order);
    assertEquals(2.0, emission, 0.01);
}
```
